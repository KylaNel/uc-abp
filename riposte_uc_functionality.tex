\begin{tcolorbox}[enhanced, colback=white, arc=5pt, breakable]
\noindent\emph{\underline{Anonymous broadcast functionality $\mathcal{F}_R^K$}}\\[5pt]
 Initialise:
 \begin{enumerate}
     \item a list of pending messages $L_{pend} \leftarrow []$
     \item $status_P\in\{0,1\}\leftarrow 0$ for party $P$ indicating whether $P$ has sent a message in the current round
 \end{enumerate}
 
 
\extitem Upon receiving (\textbf{sid}, \textbf{WRITE}, $M$) from honest party $P$ or (\textbf{sid}, \textbf{WRITE}, $M$, $P$) from $S$ on behalf of corrupted party $P$:\\
If $status_P=0$, then
\begin{enumerate}
    \item set $status_P\leftarrow 1$
    \item append $M$ to $L_{pend}$
    \item if $|L_{pend}|=K$, then
    \begin{enumerate}
        \item order the messages lexicographically as $<M_1,...,M_K>$
        \item set $L{pend}\leftarrow []$
        \item set $status_P\leftarrow 0$ for every $P$
        \item send (\textbf{sid}, \textbf{BROADCAST}, $<M_1,...M_K>$ to all parties and (\textbf{sid}, \textbf{BROADCAST}, $<M_1,...M_K>, P)$ to $S$
    \end{enumerate}
    \item else, send (\textbf{sid}, \textbf{WRITE}, $|M|$, $P$) to $S$
\end{enumerate}





\end{tcolorbox}
\captionof{figure}{Anonymous broadcast ideal functionality.}
\label{fig:riposte_functionality}